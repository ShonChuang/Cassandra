(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{213:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("Cassandra 提供了三種安全性功能的組件設定：")]),t._v(" "),s("ul",[s("li",[t._v("TLS/SSL 叢集間的連線加密")]),t._v(" "),s("li",[t._v("客戶端認證")]),t._v(" "),s("li",[t._v("一般授權認證")])]),t._v(" "),s("p",[t._v("Cassandra預設是"),s("strong",[t._v("不啟用")]),t._v("該功能，是為了容易示使用找尋到其他在叢集中的節點。")]),t._v(" "),s("h2",{attrs:{id:"tls-ssl-加密"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#tls-ssl-加密","aria-hidden":"true"}},[t._v("#")]),t._v(" TLS/SSL 加密")]),t._v(" "),s("p",[t._v("Cassandra 提供的安全連線機制，如"),s("strong",[t._v("客戶端與資料庫連線加密")]),t._v("或者叢集中的"),s("strong",[t._v("客戶端對節點")]),t._v("、"),s("strong",[t._v("節點對節點")]),t._v("的連線加密，且這些設定可以"),s("strong",[t._v("單獨管理與設定")]),t._v("。")]),t._v(" "),s("p",[t._v("這些加密設定可以透過修改 "),s("strong",[t._v("cassandra.yaml")]),t._v(" 調整，就會覆蓋JVM的設定，但不建議著麼做，除非你有特殊的需求。\n"),s("strong",[t._v("預設驗證關閉")])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Authentication backend, implementing IAuthenticator; used to identify users")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Out of the box, Cassandra provides org.apache.cassandra.auth.{AllowAllAuthenticator,")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# PasswordAuthenticator}.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - AllowAllAuthenticator performs no checks - set it to disable authentication.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - PasswordAuthenticator relies on username/password pairs to authenticate")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   users. It keeps usernames and hashed passwords in system_auth.roles table.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   Please increase system_auth keyspace replication factor if you use this authenticator.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   If using PasswordAuthenticator, CassandraRoleManager must also be used (see below)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("authenticator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" AllowAllAuthenticator\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Authorization backend, implementing IAuthorizer; used to limit access/provide permissions")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Out of the box, Cassandra provides org.apache.cassandra.auth.{AllowAllAuthorizer,")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# CassandraAuthorizer}.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - AllowAllAuthorizer allows any action to any user - set it to disable authorization.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - CassandraAuthorizer stores permissions in system_auth.role_permissions table. Please")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   increase system_auth keyspace replication factor if you use this authorizer.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("authorizer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" AllowAllAuthorizer\n")])])]),s("p",[s("strong",[t._v("資料傳輸加密設定")])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("transparent_data_encryption_options")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("chunk_length_kb")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cipher")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" AES/CBC/PKCS5Padding\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key_alias")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" testing"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# CBC IV length for AES needs to be 16 bytes (which is also the default size)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# iv_length: 16")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key_provider")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("class_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" org.apache.cassandra.security.JKSKeyProvider\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("parameters")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keystore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" conf/.keystore\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keystore_password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cassandra\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("store_type")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" JCEKS\n        "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key_password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cassandra\n")])])]),s("p",[s("strong",[t._v("Server/Client 加密選項")])]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server_encryption_options")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("internode_encryption")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" none\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keystore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" conf/.keystore\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keystore_password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cassandra\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("truststore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" conf/.truststore\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("truststore_password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cassandra\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# More advanced defaults below:")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# protocol: TLS")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# algorithm: SunX509")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# store_type: JKS")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cipher_suites: [TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA]")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# require_client_auth: false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# require_endpoint_verification: false")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# enable or disable client/server encryption.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client_encryption_options")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# If enabled and optional is set to true encrypted and unencrypted connections are handled.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("optional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keystore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" conf/.keystore\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keystore_password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cassandra\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# require_client_auth: false")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Set trustore and truststore_password if require_client_auth is true")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# truststore: conf/.truststore")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# truststore_password: cassandra")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# More advanced defaults below:")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# protocol: TLS")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# algorithm: SunX509")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# store_type: JKS")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cipher_suites: [TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA]")]),t._v("\n    \n")])])]),s("h2",{attrs:{id:"ssl-認證即時重載"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ssl-認證即時重載","aria-hidden":"true"}},[t._v("#")]),t._v(" SSL 認證即時重載")]),t._v(" "),s("p",[t._v("Cassandra 4 提供了 SSL 認證及重載。如果於 cassandra.yaml 已啟用 SSL/TSL 加密服務，叢集節點輪詢服務與金鑰存取服務。若檔案異動則會啟用完成("),s("em",[t._v("零停機修改設定，這在微服務環境中種要")]),t._v(")。輪詢時間預設為10分鐘("),s("em",[t._v("尚未找到該設定")]),t._v(")。\n也可以透過指令方式觸發立即重載 "),s("span",{staticStyle:{padding:"2px 4px",color:"#c7254e","background-color":"#f9f2f4","border-radius":"4px"}},[t._v("nodetool reloadssl")]),t._v("。")]),t._v(" "),s("h4",{attrs:{id:"設定節點加密"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#設定節點加密","aria-hidden":"true"}},[t._v("#")]),t._v(" 設定節點加密")]),t._v(" "),s("p",[t._v("在 cassandra.yaml 找到 "),s("strong",[t._v("server_encryption_option")]),t._v(" 區段")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server_encryption_options")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("internode_encryption")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" none //設定 racl、dc、all\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keystore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" conf/.keystore\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keystore_password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cassandra\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("truststore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" conf/.truststore\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("truststore_password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cassandra\n")])])]),s("h4",{attrs:{id:"設定客戶端對節點加密"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#設定客戶端對節點加密","aria-hidden":"true"}},[t._v("#")]),t._v(" 設定客戶端對節點加密")]),t._v(" "),s("p",[t._v("在 cassandra.yaml 找到 "),s("strong",[t._v("client_encryption_options")]),t._v(" 區段")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client_encryption_options")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# If enabled and optional is set to true encrypted and unencrypted connections are handled.")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("optional")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keystore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" conf/.keystore\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("keystore_password")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" cassandra\n")])])]),s("p",[t._v("這裡有兩個參數可以設定 "),s("strong",[t._v("enable")]),t._v(" 與 "),s("strong",[t._v("optional")]),t._v("，代表的連線加密規則不一樣。")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"center"}},[t._v("enable")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("optional")]),t._v(" "),s("th",{staticStyle:{"text-align":"center"}},[t._v("連線")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("false")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("false")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("未加密")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("true")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("false")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("加密")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"center"}},[t._v("true")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("true")]),t._v(" "),s("td",{staticStyle:{"text-align":"center"}},[t._v("未加密、加密")])])])]),t._v(" "),s("p",[t._v("optional 可以透過設定不同的port來設定連線方式：\n將 "),s("em",[t._v("optional")]),t._v(" 設為 false 然後將 "),s("em",[t._v("native_transport_port_ssl")]),t._v(" 指定對應的 port")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("native_transport_port_ssl")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("9142")]),t._v("\n")])])]),s("div",{staticClass:"tip custom-block"},[s("p",[t._v("native_transport_port：9042(預設連線Port為)\nstorage_port：7000\nssl_storage_port：7001")])]),t._v(" "),s("p",[t._v("##角色\nCassandra 使用資料庫裡的角色來管理，使用資料庫的帳號與群組，與授權或權限，預設 "),s("strong",[t._v("role_manager")]),t._v(" 是使用 "),s("strong",[t._v("CassandraRoleManager")]),t._v(" 這個角色管理。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# - CassandraRoleManager stores role data in the system_auth keyspace. Please")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   increase system_auth keyspace replication factor if you use this role manager.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("role_manager")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CassandraRoleManager\n")])])]),s("h2",{attrs:{id:"認證"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#認證","aria-hidden":"true"}},[t._v("#")]),t._v(" 認證")]),t._v(" "),s("p",[t._v("預設為 "),s("strong",[t._v("AllowAllAuthenricator")]),t._v(" 代表無須認證。")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("authenticator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" AllowAllAuthenticator\n")])])]),s("p",[t._v("改為預設 "),s("strong",[t._v("PasswordAuthenticator")]),t._v(" 簡單密碼認證，密碼將會加密儲存在 system table 中。")]),t._v(" "),s("h4",{attrs:{id:"設定密碼認證"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#設定密碼認證","aria-hidden":"true"}},[t._v("#")]),t._v(" 設定密碼認證")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" cqlsh  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 進入 cqlsh")]),t._v("\ncqlsh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" DESCRIBE system_auth "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查詢system_auth 結構")]),t._v("\n\nCREATE KEYSPACE system_auth WITH replication = "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("'class'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'SimpleStrategy'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("'replication_factor'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  AND durable_writes = true;\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 預設 keyspace 使用 SimpleStrategy 與 replication_factor 為 1，")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改建立副本方式")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# DC1 與 DC2 為3個節點")]),t._v("\ncqlsh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" ALTER KEYSPACE system_auth WITH replication = "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("'class'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'NetworkTopologyStrategy'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("'DC1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("'DC2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(";\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 修改 cassandra.yaml")]),t._v("\ncqlsh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" vi /etc/cassandra/cassandra.yaml\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("authenticator")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PasswordAuthenticator\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重新啟動 node")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 退出cassandra docker ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 執行 docker restart images name")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#再次進入 cqlsh 使用系統管理員登入")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" cqlsh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("u cassandra "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p cassandra\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 建立新的管理員帳號角色")]),t._v("\ncassandra@cqlsh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" CREATE ROLE dba WITH SUPERUSER = true AND LOGIN = true AND PASSWORD = 'super';\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重新開啟新的 cqlsh 並使用新的管理員帳號登入")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" cqlsh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("u dba "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p super\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查詢 role table")]),t._v("\ndba@cqlsh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" List ROLES;\n\n role      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" can_login "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" is_superuser "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" member_of "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" salted_hash\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("+"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("\n       dba "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("      True "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("         True "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("      null "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" $2a$10$a32Ml1gFD2.05R8NcQdniuwZWdaCxv/hqUWGPzAR6kk6ja5AnYRUO\n cassandra "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("      True "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("         True "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v("      null "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("|")]),t._v(" $2a$10$iIzmj16UWvMJm3nTxoNWLu/MeS2tuVNsmm329/Wyjnsn1MrhqFgK6\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 將預設的 cassandra 取消管理員權限")]),t._v("\ndba@cqlsh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" ALTER ROLE cassandra WITH SUPERUSER = false AND LOGIN = false;\n\n")])])]),s("p",[t._v("完成，若有使用叢集，請確認每個節點都有更新。")]),t._v(" "),s("h2",{attrs:{id:"授權"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#授權","aria-hidden":"true"}},[t._v("#")]),t._v(" 授權")]),t._v(" "),s("p",[t._v("預設為 "),s("strong",[t._v("AllowAllAuthorizer")]),t._v(" 代表無須授權。\n改為預設 "),s("strong",[t._v("CassandraAuthorizer")]),t._v(" 給予管理者授權，功能存到系統表中")]),t._v(" "),s("h4",{attrs:{id:"設定內部授權"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#設定內部授權","aria-hidden":"true"}},[t._v("#")]),t._v(" 設定內部授權")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 開啟 cassandra.yaml，修改 authorizer ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("authorizer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" CassandraAuthorizer\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重新啟動 node")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 退出cassandra docker ")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 執行 docker restart images name")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#再次進入 cqlsh 使用系統管理員登入")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" cqlsh "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("u dba "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("p super\ndba@cqlsh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" \n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用 Grant 改變權限，其他的叢集節點直到更新(重複1、2步驟)或者節點重新啟動，這樣不會影像到客戶端連線。")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 假設已經有 \bkeyspace = mytest , table = t1 , db_user=dba")]),t._v("\ndba@cqlsh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" gaant select on mytest.t1 To dba;\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查詢設定的權限")]),t._v("\ndba@cqlsh"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" List All Pressions of dba;\n\n")])])]),s("h2",{attrs:{id:"快取"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#快取","aria-hidden":"true"}},[t._v("#")]),t._v(" 快取")]),t._v(" "),s("p",[t._v("啟用認證與授權機制將會頻繁地讀取"),s("strong",[t._v("sysem_auth")]),t._v(" 資料表，且連線會有需多使用者操作，將會容易造成服務競爭碰撞，透過設定快取緩存可以減輕認證、授權、權限和角色的負載。\n每個快取緩存有三個選項設定：")]),t._v(" "),s("ul",[s("li",[t._v("Validiry Period ：設定有快取效期間，過期後會由快取中刪除")]),t._v(" "),s("li",[t._v("Refresh Rate ：設定背景底層更新頻率，將會非同步執行更新")]),t._v(" "),s("li",[t._v("Max Entries ：快取的儲存大小")])]),t._v(" "),s("p",[t._v("開啟 cassandra.yaml 將會有三種類型的快取，但都離不開上述三種選項：")]),t._v(" "),s("ul",[s("li",[t._v("<type>_validity_in_ms")]),t._v(" "),s("li",[t._v("<type>_update_interval_in_ms")]),t._v(" "),s("li",[t._v("<type>_cache_max_entries 這設定因該改變，為 "),s("em",[t._v("key_cache_size_in_mb")]),t._v(" 與 "),s("em",[t._v("row_cache_size_in_mb")])])])])}),[],!1,null,null,null);a.default=e.exports}}]);